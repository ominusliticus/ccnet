
// STL
#include <cassert>
#include <complex>
#include <cstdint>
#include <utility>
#include <vector>

// CCNet
#include "matrix/dense_matrix.hpp"
#include "matrix/factor.hpp"

// SYCL Dependencies
#if USE_SYCL
  #include <sycl/sycl.hpp>
#endif

using Index     = std::size_t;
using IndexList = std::vector<std::pair<Index, Index>>;
using Field     = std::complex<double>;

auto
main(
) -> int 
{
    Matrix<Field> mat {{
         {8.53036, 0.02642}, {2.10276, 4.10980}, {1.09350, 7.52544},
         {5.21582, 5.89088}, {2.09163, 5.00381}, {8.53030, 1.84945},
         {1.40135, 8.49991}, {2.24332, 7.27830}, {6.48468, 8.67698},
         {1.39768, 0.58108}, {2.63978, 8.68788}, {2.76522, 8.89657},
         {0.91650, 3.48762}, {4.24442, 1.52522}, {7.92960, 8.37088},
         {6.28309, 0.74284}, {3.24625, 4.85203}, {7.75354, 7.79232}
    }};

    Matrix<Field> q_mat {{
        {-0.52479780, -0.00162539}, {0.287810300, -0.17716223}, {-0.21407393, 0.409035650},
        {-0.32088336, -0.36241388}, {-0.02495825, -0.00261589}, {0.327076970, -0.36708298},
        {-0.08621270, -0.52292450}, {-0.30855290, -0.14360005}, {0.088656890, -0.16340996},
        {-0.08598692, -0.03574873}, {-0.17000832, -0.71088743}, {-0.06163096, -0.25688833},
        {-0.05638416, -0.21456249}, {-0.40369433, 0.078763000}, {0.089361310, 0.548088850},
        {-0.38654310, -0.04570039}, {0.044858780, -0.25273386}, {0.252035260, 0.262433740}
    }};
    Matrix<Field> r_mat {{
        {-16.254566, +0.}, {-10.174922 , -4.0105386}, {-15.242247, -0.90103704},
        {  0.      , +0.}, {-11.2244005, +0.       }, {-15.441081, -0.65175635},
        {  0.      , +0.}, {  0.       , +0.       }, { 10.952124, +0.        }
    }};

    
    auto [q, r] = TRY_MAIN(qr_factor(mat));
    assert(TRY_MAIN(q.eq(q_mat)));
    assert(TRY_MAIN(r.eq(r_mat)));
    return 0;
}
