
// STL
#include <cassert>
#include <complex>
#include <cstdint>
#include <utility>
#include <vector>

// CCNet
#include "print.hpp"
#include "matrix/dense_matrix.hpp"
#include "matrix/factor.hpp"

// SYCL Dependencies
#if USE_SYCL
  #include <sycl/sycl.hpp>
#endif

using Index     = std::size_t;
using IndexList = std::vector<std::pair<Index, Index>>;
using Field     = std::complex<double>;

auto
main(
) -> int 
{
    Matrix<Field> mat = Matrix<Field>::from_col_major(6, 3, {
         {8.53036, 0.02642}, {2.10276, 4.10980}, {1.09350, 7.52544},
         {5.21582, 5.89088}, {2.09163, 5.00381}, {8.53030, 1.84945},
         {1.40135, 8.49991}, {2.24332, 7.27830}, {6.48468, 8.67698},
         {1.39768, 0.58108}, {2.63978, 8.68788}, {2.76522, 8.89657},
         {0.91650, 3.48762}, {4.24442, 1.52522}, {7.92960, 8.37088},
         {6.28309, 0.74284}, {3.24625, 4.85203}, {7.75354, 7.79232}
    });
    println(mat);

    Matrix<Field> q_mat = Matrix<Field>::from_col_major(6, 6, {
        {-0.5247978 , -0.00162539},  {0.28781030, -0.17716223},  {-0.21407393 , +0.40903565},
        {-0.31263566, -0.25732872},  {0.07426061, -0.14406404},  {-0.42875624 , -0.15220211},
        {-0.32088336, -0.36241388},  {-0.02495825, -0.00261589}, {  0.32707697, -0.36708298},
        {-0.16661763, -0.08610550},  {0.0302469,  +0.5840794},   {-0.25420964 , +0.28542823},
        {-0.0862127 , -0.52292450},  {-0.3085529,  -0.14360005}, {  0.08865689, -0.16340996},
        {-0.43279248, +0.29955718},  {0.01980393, -0.5168457},   { 0.11105568 , -0.10876471},
        {-0.08598692, -0.03574873},  {-0.17000832, -0.71088743}, { -0.06163096, -0.25688833},
        { 0.5491159 , -0.13942572},  {0.01205047, -0.16620794},  {-0.19526276 , +0.02022207},
        {-0.05638416, -0.21456249},  {-0.40369433, +0.078763},   {  0.08936131, +0.54808885},
        { 0.306505  , +0.27759248},  {0.49635166, +0.20194598},  {-0.10461199 , -0.06426887},
        {-0.3865431 , -0.04570039},  {0.04485878, -0.25273386},  { 0.25203526 , +0.26243374},
        { 0.04812982, -0.17185550},  {-0.16720955, +0.14583938}, {  0.7503172 , -0.07849244}

    });
    Matrix<Field> r_mat = Matrix<Field>::from_col_major(6, 3, {
        {-16.254566, +0.}, {-10.174922 , -4.0105386}, {-15.242247, -0.90103704},
        {  0.      , +0.}, {-11.2244005, +0.       }, {-15.441081, -0.65175635},
        {  0.      , +0.}, {  0.       , +0.       }, { 10.952124, +0.        },
        {  0.      , +0.}, {  0.       , +0.       }, { 0.0      , +0.        },
        {  0.      , +0.}, {  0.       , +0.       }, { 0.0      , +0.        },
        {  0.      , +0.}, {  0.       , +0.       }, { 0.0      , +0.        }
    });
    
    auto [q, r] = TRY_MAIN(qr_factor(mat));
    assert(TRY_MAIN(q.eq(q_mat, 1e-6)));
    assert(TRY_MAIN(r.eq(r_mat, 1e-6)));
    return 0;
}
